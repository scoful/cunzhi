# 连一下 - "寸止"实例管理器使用教程

## 1. 什么是"连一下"

"连一下"是一个"寸止"实例管理器,用于管理多个寸止实例的连接。它可以:

- 📡 **管理多个寸止实例** - 同时连接多个远程寸止实例
- 🔐 **支持API Key认证** - 安全的实例认证机制
- 📊 **实时活动日志** - 显示所有事件
- 🚀 **自动连接** - 启动时自动连接到配置的实例
- 🔔 **接收弹窗请求** - 接收远程"寸止"实例的弹窗请求并启动"等一下"界面

### 典型使用场景

**远程开发环境的UI交互桥梁**

在Linux服务器或远程开发环境中,运行在无图形界面系统上的"寸止"实例无法直接调用本地的"等一下"界面与用户交互。"连一下"作为WebSocket客户端管理器,充当本地与远程之间的通信桥梁,让远程"寸止"可以通过WebSocket调用本地"等一下",实现远程无头环境与本地图形界面的无缝协作。

---

## 2. 快速开始

### 启动应用

```bash
# 开发模式
pnpm tauri:dev:lian-yi-xia

# 生产模式
./连一下.exe  # Windows
./连一下      # Linux/Mac
```

### 界面介绍

应用界面分为两个主要区域:

- **寸止实例列表** - 显示所有配置的寸止实例及其连接状态
- **活动日志** - 实时显示通信事件

---

## 3. 添加寸止实例

### 步骤

1. 点击右上角的 **"添加实例"** 按钮
2. 填写实例信息:
   - **名称**: 显示名称,方便识别(如"本地测试"、"生产实例")
   - **地址**: 寸止实例地址(如`localhost`、`192.168.1.100`)
   - **端口**: 寸止实例端口(如`9000`) PS: 需要开放对应的端口
   - **API Key**: 认证密钥，点击自动生成
   - **启用**: 是否启用此实例
   - **自动连接**: 启动时是否自动连接
3. 点击 **"保存"** 按钮

### 注意事项

- **端口**: 确保防火墙允许该端口通信

---

## 4. 如何启动寸止实例

要让"连一下"能够连接到远程"寸止"实例,需要先在远程环境中启动"寸止"并开启WebSocket服务器。

### 启动步骤

> **说明**: 以下以VSCode+Augment为例。如果您使用其他MCP客户端(如Claude Desktop)或命令行环境,请参考"寸止"的配置文档。

假设在VSCode中使用Augment,通过环境变量配置"寸止"的WebSocket服务器

1. **打开Augment Settings** 
2. **Tools-MCP** 
3. **如果没安装过寸止，按照Readme的教程安装**
4. **点开安装好的寸止最右边的3个点-Edit-Environment Variables**
5. **添加2个环境变量**
     "CUNZHI_WS_PORT": "上一步连一下设置的端口"
     "CUNZHI_WS_API_KEY": "上一步连一下生成的key"
4. **重启寸止，通过点击开关，使配置生效**

### 关键注意事项

- **防火墙配置**: 确保远程服务器的防火墙允许WebSocket端口(如9000)的入站连接
- **网络可达性**: 确保本地机器可以访问远程服务器的IP地址和端口
- **API Key一致性**: "连一下"配置的API Key必须与远程"寸止"实例的API Key完全一致
- **端口占用**: 确保配置的端口未被其他服务占用

---

## 5. 管理寸止实例

### 查看实例状态

实例卡片显示以下信息:

- **名称**: 实例显示名称
- **地址**: 实例地址和端口
- **状态**: 
  - 🟢 **已连接** - 实例正常连接
  - 🔴 **未连接** - 实例未连接
  - ⚪ **已禁用** - 实例已禁用

### 实例操作

- **启用/禁用**: 点击开关切换实例启用状态
- **连接/断开**: 点击按钮手动连接或断开实例
- **编辑**: 点击编辑按钮修改实例配置
- **删除**: 点击删除按钮移除实例配置

---

## 6. 活动日志

活动日志实时显示所有通信事件,包括:

- 🔵 **信息** - 一般信息(连接、断开等)
- 🟢 **成功** - 操作成功
- 🟡 **警告** - 警告信息
- 🔴 **错误** - 错误信息

### 日志操作

- **清空日志**: 点击"清空日志"按钮清除所有日志
- **自动滚动**: 日志会自动滚动到最新消息

---

## 7. 工作流程

### 典型工作流程

1. **启动"连一下"** - 打开应用
2. **自动连接** - 应用自动连接到配置的实例
3. **接收请求** - 远程"寸止"实例发送弹窗请求
4. **启动"等一下"** - "连一下"自动启动"等一下"界面
5. **用户操作** - 用户在"等一下"界面中进行操作
6. **返回响应** - "连一下"将用户响应发送回远程"寸止"实例

### 消息流程

```
远程"寸止" → WebSocket → "连一下" → 启动"等一下" → 用户操作 → "连一下" → WebSocket → 远程"寸止"
```

---

## 8. 常见问题

### Q: 无法连接到实例?

**A**: 检查以下几点:
- 远程"寸止"实例是否正在运行
- WebSocket服务器是否已启用
- 防火墙是否允许端口通信
- API Key是否正确
- 网络是否可达

### Q: 连接后没有收到弹窗请求?

**A**: 检查以下几点:
- 远程"寸止"实例是否配置了正确的WebSocket端口
- 远程"寸止"实例是否正在发送请求
- 查看活动日志是否有错误信息

### Q: "等一下"界面没有启动?

**A**: 检查以下几点:
- "等一下"可执行文件是否存在
- "等一下"可执行文件是否有执行权限
- 查看活动日志是否有错误信息

### Q: 如何查看详细的通信日志?

**A**: 
- 查看"连一下"的活动日志

---

## 9. 使用建议

### 安全建议

- **API Key**: 使用强随机API Key,不要使用简单密码
- **网络**: 在公网环境中使用时,建议使用VPN或SSH隧道
- **防火墙**: 仅允许必要的IP地址访问WebSocket端口

### 性能建议

- **实例数量**: 根据实际需要配置实例,避免配置过多未使用的实例
- **自动连接**: 仅对常用实例启用自动连接
- **日志清理**: 定期清空活动日志,避免占用过多内存

### 使用技巧

- **命名规范**: 使用清晰的实例名称,如"开发环境"、"生产环境"
- **端口规划**: 为不同实例使用不同端口,避免冲突
- **备份配置**: 定期备份配置文件,避免配置丢失

---

## 10. 故障排除

### 连接问题

1. **检查网络连接**
   ```bash
   # 测试端口是否可达
   telnet <host> <port>
   # 或使用
   nc -zv <host> <port>
   ```

2. **检查防火墙规则**
   ```bash
   # Linux
   sudo ufw status
   sudo ufw allow <port>
   
   # Windows
   netsh advfirewall firewall show rule name=all
   ```

3. **检查"寸止"实例状态**
   - 查看"寸止"日志
   - 确认WebSocket服务器已启动
   - 确认API Key配置正确

### 日志分析

- **连接失败**: 检查网络和防火墙
- **认证失败**: 检查API Key是否正确
- **超时**: 检查网络延迟和服务器负载
- **协议错误**: 检查"寸止"版本是否兼容

---

**感谢使用"连一下"!**
